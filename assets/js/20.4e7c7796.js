(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{358:function(s,t,a){s.exports=a.p+"assets/img/bindmount.2ba10c87.png"},425:function(s,t,a){"use strict";a.r(t);var n=a(41),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_7-数据盘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-数据盘"}},[s._v("#")]),s._v(" 7.数据盘")]),s._v(" "),n("ul",[n("li",[s._v("删除容器的时候，容器层里创建的文件也会被删除掉，如果有些数据你想永久保存，比如Web服务器的日志，数据库管理系统中的数据，可以为容器创建一个数据盘")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(358),alt:"docker架构",title:"docker架构"}})]),s._v(" "),n("h2",{attrs:{id:"_7-1-volume"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-volume"}},[s._v("#")]),s._v(" 7.1 volume")]),s._v(" "),n("ul",[n("li",[s._v("volumes Docker管理宿主机文件系统的一部分(/var/lib/docker/volumes)")]),s._v(" "),n("li",[s._v("如果没有指定卷，则会自动创建")]),s._v(" "),n("li",[s._v("建议使用--mount ,更通用")])]),s._v(" "),n("h2",{attrs:{id:"_7-1-1-创建数据卷"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-1-创建数据卷"}},[s._v("#")]),s._v(" 7.1.1 创建数据卷")]),s._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker volume --help\ndocker volume create nginx-vol\ndocker volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\ndocker volume inspect nginx-vol\n")])])]),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#把nginx-vol数据卷挂载到/usr/share/nginx/html,挂载后容器内的文件会同步到数据卷中")]),s._v("\ndocker run -d  --name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx1 --mount "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx-vol,dst"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/share/nginx/html nginx\ndocker run -d  --name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx2  -v nginx-vol:/usr/share/nginx/html -p "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(":80 nginx\n")])])]),n("h2",{attrs:{id:"_7-1-2-删除数据卷"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-2-删除数据卷"}},[s._v("#")]),s._v(" 7.1.2 删除数据卷")]),s._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker container stop nginx1 停止容器\ndocker container "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nginx1 删除容器\ndocker volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nginx-vol  删除数据库\n")])])]),n("h2",{attrs:{id:"_7-1-3-管理数据卷"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-3-管理数据卷"}},[s._v("#")]),s._v(" 7.1.3 管理数据卷")]),s._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出所有的数据盘")]),s._v("\ndocker volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("dangling")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出已经孤立的数据盘")]),s._v("\ndocker volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" xxxx "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除数据盘")]),s._v("\ndocker volume "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出数据盘")]),s._v("\n")])])]),n("h2",{attrs:{id:"_7-2-bind-mounts"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-bind-mounts"}},[s._v("#")]),s._v(" 7.2 Bind mounts")]),s._v(" "),n("ul",[n("li",[s._v("此方式与Linux系统的mount方式很相似，即是会覆盖容器内已存在的目录或文件，但并不会改变容器内原有的文件，当umount后容器内原有的文件就会还原")]),s._v(" "),n("li",[s._v("创建容器的时候我们可以通过"),n("code",[s._v("-v")]),s._v("或"),n("code",[s._v("--volumn")]),s._v("给它指定一下数据盘")]),s._v(" "),n("li",[n("code",[s._v("bind mounts")]),s._v(" 可以存储在宿主机系统的任意位置")]),s._v(" "),n("li",[s._v("如果源文件/目录不存在，不会自动创建，会抛出一个错误")]),s._v(" "),n("li",[s._v("如果挂载目标在容器中非空目录，则该目录现有内容将被隐藏")])]),s._v(" "),n("h2",{attrs:{id:"_7-2-1-默认数据盘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-1-默认数据盘"}},[s._v("#")]),s._v(" 7.2.1 默认数据盘")]),s._v(" "),n("ul",[n("li",[s._v("-v 参数两种挂载数据方式都可以用")])]),s._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker run -v /mnt:/mnt -it --name logs centos "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /mnt\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n\n")])])]),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker inspect logs\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Mounts"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Source"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt/sda1/var/lib/docker/volumes/dea6a8b3aefafa907d883895bbf931a502a51959f83d63b7ece8d7814cf5d489/_data"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Destination"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/mnt"')]),s._v(",\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),n("ul",[n("li",[n("code",[s._v("Source")]),s._v(" 的值就是我们给容器指定的数据盘在主机上的位置")]),s._v(" "),n("li",[n("code",[s._v("Destination")]),s._v(" 的值是这个数据盘在容器上的位置")])]),s._v(" "),n("h2",{attrs:{id:"_7-2-2-指定数据盘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-2-指定数据盘"}},[s._v("#")]),s._v(" 7.2.2 指定数据盘")]),s._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker run -v ~/data:/mnt -it --name logs2 centos "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /mnt\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".txt\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" ~/data/3.txt\n")])])]),n("ul",[n("li",[s._v("~/data:/mnt 把当前用户目录中的data目录映射到/mnt上")])]),s._v(" "),n("h2",{attrs:{id:"_7-2-3-指定数据盘容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-3-指定数据盘容器"}},[s._v("#")]),s._v(" 7.2.3 指定数据盘容器")]),s._v(" "),n("ul",[n("li",[s._v("docker create [OPTIONS] IMAGE [COMMAND] [ARG...] 创建一个新的容器但不启动")])]),s._v(" "),n("div",{staticClass:"language-sh extra-class"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("docker create -v /mnt:/mnt --name logger centos\ndocker run --volumes-from logger --name logger3 -i -t centos "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /mnt \n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" logger3\ndocker run --volumes-from logger --name logger4 -i -t centos "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /mnt\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" logger4\n\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);