(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{360:function(t,s,a){t.exports=a.p+"assets/img/18.56cd7d54.png"},361:function(t,s,a){t.exports=a.p+"assets/img/19.6e04ca54.png"},430:function(t,s,a){"use strict";a.r(s);var n=a(41),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"_10-发布php项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-发布php项目"}},[t._v("#")]),t._v(" 10.发布PHP项目")]),t._v(" "),n("h2",{attrs:{id:"_10-1-创建本地项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-创建本地项目"}},[t._v("#")]),t._v(" 10.1 创建本地项目")]),t._v(" "),n("ul",[n("li",[t._v("先登录git服务器创建php仓库")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("mkdir "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("git"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("repos"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("php"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\ncd "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("git"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("repos"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("php"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\ngit init "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("bare\n")])])]),n("h2",{attrs:{id:"_10-2-拉取代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-拉取代码"}},[t._v("#")]),t._v(" 10.2 拉取代码")]),t._v(" "),n("ul",[n("li",[t._v("拉取并初始化本地仓库")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("git clone  git@"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".20")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v(".131")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("git"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("repos"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dev"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("php"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\ncd php\necho "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<?php echo info()?>"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php\ngit add "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("A")]),t._v("\ngit commit "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"add index.php"')]),t._v("\ngit push origin master\n")])])]),n("h2",{attrs:{id:"_10-3-部署环境"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-部署环境"}},[t._v("#")]),t._v(" 10.3 部署环境")]),t._v(" "),n("ul",[n("li",[t._v("安装php")]),t._v(" "),n("li",[t._v("安装nginx")])]),t._v(" "),n("h2",{attrs:{id:"_10-4-创建项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-创建项目"}},[t._v("#")]),t._v(" 10.4 创建项目")]),t._v(" "),n("h2",{attrs:{id:"_10-4-1-构建参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-1-构建参数"}},[t._v("#")]),t._v(" 10.4.1 构建参数")]),t._v(" "),n("p",[n("img",{attrs:{src:a(360),alt:"效果图",title:"效果图"}}),t._v(" "),n("img",{attrs:{src:a(361),alt:"效果图",title:"效果图"}})]),t._v(" "),n("h2",{attrs:{id:"_10-4-2-pipeline脚本"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-4-2-pipeline脚本"}},[t._v("#")]),t._v(" 10.4.2 pipeline脚本")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("先在git服务器里创建一个dev-php项目")])]),t._v(" "),n("li",[n("p",[t._v("然后到web服务器上克隆此项目并在里面添加文件")])]),t._v(" "),n("li",[n("p",[t._v("在pipeline服务器里添加新的脚本")])]),t._v(" "),n("li",[n("p",[t._v("给web服务器添加标签名并在pipeline脚本中引用")])]),t._v(" "),n("li",[n("p",[t._v("web服务器上的工作目录 /var/lib/jenkins/workspace/dev-php")])]),t._v(" "),n("li",[n("p",[t._v("credentialsId git/git")])])]),t._v(" "),n("p",[t._v("cat /root/pipeline/Jenkinsfile-php")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webserver'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'checkout'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("checkout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GitSCM'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" branches"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*/master'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" doGenerateSubmoduleConfigurations"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" extensions"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" submoduleCfg"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" userRemoteConfigs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("credentialsId"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'8e8e63f9-4806-4f2e-8633-c92badbdefd7'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" url"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git@192.168.20.131:/home/git/repos/${JOB_NAME}.git"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("'rm "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rf $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WORKSPACE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("git\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("backup "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("  mkdir "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("backup\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JOB_NAME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" mkdir "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JOB_NAME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n       mv "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JOB_NAME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("backup"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JOB_NAME")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-$(date +%F_%T)"')]),t._v("\n       cp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rf $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WORKSPACE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),t._v("'\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stage")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"curl http://www.${JOB_NAME}.com/status"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);