<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>10. node项目 | 运维及前端知识整理</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="文件上传组件 vue文件上传 多文件上传">
    
    <link rel="preload" href="/blog/assets/css/0.styles.b6bfb1ac.css" as="style"><link rel="preload" href="/blog/assets/js/app.19024b16.js" as="script"><link rel="preload" href="/blog/assets/js/2.4ac9db42.js" as="script"><link rel="preload" href="/blog/assets/js/18.3945b18f.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.5f05e4bc.js"><link rel="prefetch" href="/blog/assets/js/11.8cbb3676.js"><link rel="prefetch" href="/blog/assets/js/12.03608f82.js"><link rel="prefetch" href="/blog/assets/js/13.ae31a07d.js"><link rel="prefetch" href="/blog/assets/js/14.7aec61b2.js"><link rel="prefetch" href="/blog/assets/js/15.3f8cc38f.js"><link rel="prefetch" href="/blog/assets/js/16.8b056a43.js"><link rel="prefetch" href="/blog/assets/js/17.6ca74702.js"><link rel="prefetch" href="/blog/assets/js/19.5557b8cb.js"><link rel="prefetch" href="/blog/assets/js/20.4e7c7796.js"><link rel="prefetch" href="/blog/assets/js/21.1bf71de7.js"><link rel="prefetch" href="/blog/assets/js/22.29548e90.js"><link rel="prefetch" href="/blog/assets/js/23.add44d64.js"><link rel="prefetch" href="/blog/assets/js/24.80bde89b.js"><link rel="prefetch" href="/blog/assets/js/25.78d90620.js"><link rel="prefetch" href="/blog/assets/js/26.99827223.js"><link rel="prefetch" href="/blog/assets/js/27.2f512229.js"><link rel="prefetch" href="/blog/assets/js/28.01e7809a.js"><link rel="prefetch" href="/blog/assets/js/29.af9a8e11.js"><link rel="prefetch" href="/blog/assets/js/3.74a85236.js"><link rel="prefetch" href="/blog/assets/js/30.babf68d7.js"><link rel="prefetch" href="/blog/assets/js/31.38c5f139.js"><link rel="prefetch" href="/blog/assets/js/32.dd33678a.js"><link rel="prefetch" href="/blog/assets/js/33.c1d3c72b.js"><link rel="prefetch" href="/blog/assets/js/34.1d0d9a52.js"><link rel="prefetch" href="/blog/assets/js/35.7a2d7357.js"><link rel="prefetch" href="/blog/assets/js/36.ce9b60b3.js"><link rel="prefetch" href="/blog/assets/js/37.0da3ad1b.js"><link rel="prefetch" href="/blog/assets/js/38.ec9f441a.js"><link rel="prefetch" href="/blog/assets/js/39.854305ce.js"><link rel="prefetch" href="/blog/assets/js/4.04976430.js"><link rel="prefetch" href="/blog/assets/js/40.bfabdfdf.js"><link rel="prefetch" href="/blog/assets/js/41.48544c6e.js"><link rel="prefetch" href="/blog/assets/js/42.4738b895.js"><link rel="prefetch" href="/blog/assets/js/43.1b23e6fd.js"><link rel="prefetch" href="/blog/assets/js/44.c06f5d4c.js"><link rel="prefetch" href="/blog/assets/js/45.bd44d57e.js"><link rel="prefetch" href="/blog/assets/js/46.5d7a06da.js"><link rel="prefetch" href="/blog/assets/js/47.28a3484a.js"><link rel="prefetch" href="/blog/assets/js/48.cbf61cca.js"><link rel="prefetch" href="/blog/assets/js/49.46876c92.js"><link rel="prefetch" href="/blog/assets/js/5.d735502a.js"><link rel="prefetch" href="/blog/assets/js/50.7fc2c3ce.js"><link rel="prefetch" href="/blog/assets/js/51.7a88a24e.js"><link rel="prefetch" href="/blog/assets/js/52.4f09d156.js"><link rel="prefetch" href="/blog/assets/js/53.7ed4e828.js"><link rel="prefetch" href="/blog/assets/js/54.5ce05f50.js"><link rel="prefetch" href="/blog/assets/js/55.1a31bf87.js"><link rel="prefetch" href="/blog/assets/js/56.a78058d3.js"><link rel="prefetch" href="/blog/assets/js/57.afb7f5a3.js"><link rel="prefetch" href="/blog/assets/js/58.d21c783d.js"><link rel="prefetch" href="/blog/assets/js/59.23dc99cf.js"><link rel="prefetch" href="/blog/assets/js/6.da78d201.js"><link rel="prefetch" href="/blog/assets/js/60.5500c9dc.js"><link rel="prefetch" href="/blog/assets/js/61.822c2676.js"><link rel="prefetch" href="/blog/assets/js/62.30cce9e7.js"><link rel="prefetch" href="/blog/assets/js/63.4dfcb47c.js"><link rel="prefetch" href="/blog/assets/js/64.b76d89c0.js"><link rel="prefetch" href="/blog/assets/js/65.6491f519.js"><link rel="prefetch" href="/blog/assets/js/66.50af43d6.js"><link rel="prefetch" href="/blog/assets/js/7.bdc92cc3.js"><link rel="prefetch" href="/blog/assets/js/8.ac4ddad8.js"><link rel="prefetch" href="/blog/assets/js/9.2cd3555e.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.b6bfb1ac.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">运维及前端知识整理</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Typescript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Docker</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/docker/" aria-current="page" class="sidebar-link">/docker/</a></li><li><a href="/blog/docker/1.查看有没有安装源.html" class="sidebar-link">1.查看有没有安装源</a></li><li><a href="/blog/docker/10.node项目.html" class="active sidebar-link">10. node项目</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/docker/10.node项目.html#_10-1-服务分类" class="sidebar-link">10.1 服务分类</a></li><li class="sidebar-sub-header"><a href="/blog/docker/10.node项目.html#_10-2-app目录结构" class="sidebar-link">10.2 app目录结构</a></li><li class="sidebar-sub-header"><a href="/blog/docker/10.node项目.html#_10-2-1-docker-compose-yml" class="sidebar-link">10.2.1 docker-compose.yml</a></li><li class="sidebar-sub-header"><a href="/blog/docker/10.node项目.html#_10-2-2-sever-js" class="sidebar-link">10.2.2 sever.js</a></li><li class="sidebar-sub-header"><a href="/blog/docker/10.node项目.html#_10-2-3-package-json" class="sidebar-link">10.2.3 package.json</a></li><li class="sidebar-sub-header"><a href="/blog/docker/10.node项目.html#_10-2-4-images-node-dockerfile" class="sidebar-link">10.2.4 images/node/Dockerfile</a></li><li class="sidebar-sub-header"><a href="/blog/docker/10.node项目.html#_10-2-5-images-nginx-config-default-conf" class="sidebar-link">10.2.5 images/nginx/config/default.conf</a></li></ul></li><li><a href="/blog/docker/2.docker架构.html" class="sidebar-link">2.docker 架构</a></li><li><a href="/blog/docker/3.镜像命令.html" class="sidebar-link">3.镜像命令</a></li><li><a href="/blog/docker/4.容器命令.html" class="sidebar-link">4.容器命令</a></li><li><a href="/blog/docker/5.commit制作个性化镜像.html" class="sidebar-link">5. commit制作个性化镜像</a></li><li><a href="/blog/docker/6.制作Dockerfile.html" class="sidebar-link">6. 制作Dockerfile</a></li><li><a href="/blog/docker/7.数据盘.html" class="sidebar-link">7.数据盘</a></li><li><a href="/blog/docker/8.网络.html" class="sidebar-link">8.网络</a></li><li><a href="/blog/docker/9.Compose.html" class="sidebar-link">9. Compose</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Jenkins</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Mac Book</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vi</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_10-node项目"><a href="#_10-node项目" class="header-anchor">#</a> 10. node项目</h1> <ul><li>nodeapp 是一个用 Docker 搭建的本地 Node.js 应用开发与运行环境。</li></ul> <h2 id="_10-1-服务分类"><a href="#_10-1-服务分类" class="header-anchor">#</a> 10.1 服务分类</h2> <ul><li>db：使用 <code>mariadb</code> 作为应用的数据库</li> <li>node：启动<code>node</code>服务</li> <li>web：使用 <code>nginx</code> 作为应用的 web 服务器</li></ul> <h2 id="_10-2-app目录结构"><a href="#_10-2-app目录结构" class="header-anchor">#</a> 10.2 app目录结构</h2> <table><thead><tr><th>文件</th> <th>说明</th></tr></thead> <tbody><tr><td>docker-compose.yml</td> <td>定义本地开发环境需要的服务</td></tr> <tr><td>images/nginx/config/default.conf</td> <td>nginx 配置文件</td></tr> <tr><td>images/node/Dockerfile</td> <td>node的Dockfile配置文件</td></tr> <tr><td>images/node/web/package.json</td> <td>项目文件</td></tr> <tr><td>images/node/web/public/index.html</td> <td>静态首页</td></tr> <tr><td>images/node/web/server.js</td> <td>node服务</td></tr></tbody></table> <p><img src="/blog/assets/img/2.4b278cb1.png" alt="项目结构" title="项目结构"></p> <h2 id="_10-2-1-docker-compose-yml"><a href="#_10-2-1-docker-compose-yml" class="header-anchor">#</a> 10.2.1 docker-compose.yml</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>version: <span class="token string">'2'</span>
services:
 node:
  build:
    context: ./images/node
    dockerfile: Dockerfile
  depends_on:
   - db
 web:
  image: nginx
  ports:
   - <span class="token string">&quot;8080:80&quot;</span>
  volumes:
   - ./images/nginx/config:/etc/nginx/conf.d
   - ./images/node/web/public:/public  
  depends_on:
   - node
 db:
  image: mariadb
  environment:
   MYSQL_ROOT_PASSWORD: <span class="token string">&quot;root&quot;</span>
   MYSQL_DATABASE: <span class="token string">&quot;node&quot;</span>
   MYSQL_USER: <span class="token string">&quot;zfpx&quot;</span>
   MYSQL_PASSWORD: <span class="token string">&quot;123456&quot;</span>
  volumes:
    - db:/var/lib/mysql
volumes:
 db:
  driver: <span class="token builtin class-name">local</span>
</code></pre></div><h2 id="_10-2-2-sever-js"><a href="#_10-2-2-sever-js" class="header-anchor">#</a> 10.2.2 sever.js</h2> <p>images/node/web/server.js</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">let</span> <span class="token assign-left variable">http</span><span class="token operator">=</span>require<span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
var mysql  <span class="token operator">=</span> require<span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
var connection <span class="token operator">=</span> mysql.createConnection<span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">host</span>     <span class="token builtin class-name">:</span> <span class="token string">'db'</span>,
  user     <span class="token builtin class-name">:</span> <span class="token string">'zfpx'</span>,
  password <span class="token builtin class-name">:</span> <span class="token string">'123456'</span>,
  database <span class="token builtin class-name">:</span> <span class="token string">'node'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

connection.connect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin class-name">let</span> <span class="token assign-left variable">server</span><span class="token operator">=</span>http.createServer<span class="token punctuation">(</span>function <span class="token punctuation">(</span>req,res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    connection.query<span class="token punctuation">(</span><span class="token string">'SELECT 2 + 2 AS solution'</span>, <span class="token keyword">function</span> <span class="token punctuation">(</span>error, results, fields<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> throw error<span class="token punctuation">;</span>
        res.end<span class="token punctuation">(</span><span class="token string">''</span>+results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.solution<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server.listen<span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_10-2-3-package-json"><a href="#_10-2-3-package-json" class="header-anchor">#</a> 10.2.3 package.json</h2> <p>images/node/web/package.json</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token punctuation">{</span>
<span class="token string">&quot;scripts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;start&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;node server.js&quot;</span>
  <span class="token punctuation">}</span>,
<span class="token string">&quot;dependencies&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;mysql&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;^2.16.0&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_10-2-4-images-node-dockerfile"><a href="#_10-2-4-images-node-dockerfile" class="header-anchor">#</a> 10.2.4 images/node/Dockerfile</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>FROM node
MAINTAINER zhangrenyang <span class="token operator">&lt;</span>zhang_renyang@126.com<span class="token operator">&gt;</span>
COPY ./web /web
WORKDIR /web
RUN <span class="token function">npm</span> <span class="token function">install</span>
CMD <span class="token function">npm</span> start
</code></pre></div><h2 id="_10-2-5-images-nginx-config-default-conf"><a href="#_10-2-5-images-nginx-config-default-conf" class="header-anchor">#</a> 10.2.5 images/nginx/config/default.conf</h2> <div class="language-sh extra-class"><pre class="language-sh"><code>upstream backend <span class="token punctuation">{</span>
    server node:3000<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name localhost<span class="token punctuation">;</span>
    root /public<span class="token punctuation">;</span>
    index index.html index.htm<span class="token punctuation">;</span>

    location /api <span class="token punctuation">{</span>
        proxy_pass http://backend<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/docker/1.查看有没有安装源.html" class="prev">
        1.查看有没有安装源
      </a></span> <span class="next"><a href="/blog/docker/2.docker架构.html">
        2.docker 架构
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.19024b16.js" defer></script><script src="/blog/assets/js/2.4ac9db42.js" defer></script><script src="/blog/assets/js/18.3945b18f.js" defer></script>
  </body>
</html>
